#
# Copyright 2021-2023 Open Text.
#
# Licensed under the MIT License (the "License"); you may not use this file
# except in compliance with the License.
#
# The only warranties for products and services of Open Text and its affiliates
# and licensors ("Open Text") are as may be set forth in the express warranty
# statements accompanying such products and services. Nothing herein should be
# construed as constituting an additional warranty. Open Text shall not be
# liable for technical or editorial errors or omissions contained herein. The
# information contained herein is subject to change without notice.
#

services:

  api-service:
    image: ${ISOL_DOCKER_REGISTRY}${ISOL_DOCKER_NAME_SEP}solutions-discover-api-service${ISOL_DOCKER_VERSION_SEP}${ISOL_API_VERSION}
    networks:
      - main
    volumes:
      - ${ISOL_API_SERVICE_TLS_CERT_DIR}:/https
      - entity-data:/data/entity
    ports:
      - ${ISOL_API_SERVICE_DOCKER_PORT}:${ISOL_API_SERVICE_INTERNAL_PORT}
    environment:
      - ISOL_API_SERVICE_INIT_ENABLED=${ISOL_API_SERVICE_INIT_ENABLED}
      - ISOL_API_SERVICE_SCHEDULE_ENABLED=${ISOL_API_SERVICE_SCHEDULE_ENABLED}
      - ISOL_ENTITY_STORAGEDB_HOST=${ISOL_ENTITY_STORAGEDB_HOST}
      - ISOL_ENTITY_STORAGEDB_PORT=${ISOL_ENTITY_STORAGEDB_PORT}
      - ISOL_ENTITY_INDEXDB_HOST=${ISOL_ENTITY_INDEXDB_HOST}
      - ISOL_ENTITY_INDEXDB_ACI_PORT=${ISOL_ENTITY_INDEXDB_ACI_PORT}
      - ISOL_ENTITY_INDEXDB_INDEX_PORT=${ISOL_ENTITY_INDEXDB_INDEX_PORT}
      - ISOL_AUTH_SERVICE_PROTOCOL=${ISOL_AUTH_SERVICE_PROTOCOL}
      - ISOL_AUTH_SERVICE_HOST=${ISOL_AUTH_SERVICE_HOST}
      - ISOL_AUTH_SERVICE_PORT=${ISOL_AUTH_SERVICE_PORT}
      - ISOL_AUTH_SERVICE_PATH=${ISOL_AUTH_SERVICE_PATH}
      - ISOL_AUTH_SERVICE_EXTERNAL_PROTOCOL=${ISOL_EXTERNAL_PROTOCOL}
      - ISOL_AUTH_SERVICE_EXTERNAL_HOST=${ISOL_AUTH_SERVICE_EXTERNAL_HOST}
      - ISOL_AUTH_SERVICE_EXTERNAL_PORT=${ISOL_AUTH_SERVICE_EXTERNAL_PORT}
      - ISOL_AUTH_SERVICE_EXTERNAL_PATH=${ISOL_AUTH_SERVICE_EXTERNAL_PATH}
      - ISOL_AUTH_SERVICE_ADMIN_USER=${ISOL_AUTH_SERVICE_ADMIN_USERNAME}
      - ISOL_AUTH_SERVICE_ADMIN_PASS=${ISOL_AUTH_SERVICE_ADMIN_PASSWORD}
      - ISOL_AUTH_SERVICE_REALM=${ISOL_AUTH_SERVICE_REALM}
      - ISOL_INIT_AUTH_ADMIN_USERNAME=${ISOL_INIT_AUTH_ADMIN_USERNAME}
      - ISOL_INIT_AUTH_ADMIN_PASSWORD=${ISOL_INIT_AUTH_ADMIN_PASSWORD}
      - ISOL_AUTH_SERVICE_API_CLIENT=${ISOL_AUTH_SERVICE_API_CLIENT}
      - ISOL_AUTH_SERVICE_API_CLIENT_SECRET=${ISOL_AUTH_SERVICE_API_CLIENT_SECRET}
      - ISOL_AUTH_SERVICE_API_URL=${ISOL_EXTERNAL_PROTOCOL}://${ISOL_API_SERVICE_EXTERNAL_HOST}:${ISOL_API_SERVICE_EXTERNAL_PORT}${ISOL_API_SERVICE_EXTERNAL_PATH}
      - ISOL_AUTH_SERVICE_UI_CLIENT=${ISOL_AUTH_SERVICE_UI_CLIENT}
      - ISOL_AUTH_SERVICE_UI_URL=${ISOL_EXTERNAL_PROTOCOL}://${DISCOVER_UI_EXTERNAL_HOST}:${DISCOVER_UI_EXTERNAL_PORT}${DISCOVER_UI_EXTERNAL_PATH}*,${ISOL_AUTH_SERVICE_ADDITIONAL_UI_URLS}
      - ISOL_AUTH_SERVICE_TOKEN_EXPIRY_TIME=${ISOL_AUTH_SERVICE_TOKEN_EXPIRY_TIME}
      - ISOL_AUTH_SERVICE_BASE_REALM_ROLES=${ISOL_AUTH_SERVICE_BASE_REALM_ROLES}
      - ISOL_FILE_STORE_PROTOCOL=${ISOL_FILESTORE_SERVICE_PROTOCOL}
      - ISOL_FILE_STORE_HOST=${ISOL_FILESTORE_SERVICE_HOST}
      - ISOL_FILE_STORE_PORT=${ISOL_FILESTORE_SERVICE_PORT}
      - ISOL_FILE_STORE_PATH=${ISOL_FILESTORE_SERVICE_PATH}
      - ISOL_FILE_STORE_USER=${ISOL_FILESTORE_SERVICE_USERNAME}
      - ISOL_FILE_STORE_PASSWORD=${ISOL_FILESTORE_SERVICE_PASSWORD}
      - ISOL_FILE_STORE_BUCKET=${ISOL_FILESTORE_SERVICE_BUCKET}
      - ISOL_DATASETS_LOCATIONS_DB_HOST=${ISOL_DATASETS_LOCATIONS_DB_HOST}
      - ISOL_DATASETS_LOCATIONS_DB_ACI_PORT=${ISOL_DATASETS_LOCATIONS_DB_ACI_PORT}
      - ISOL_ANALYSIS_HOST=${ISOL_ANALYSIS_HOST}
      - ISOL_ANALYSIS_API_PORT=${ISOL_ANALYSIS_API_PORT}
      - ISOL_ANALYSIS_API_PATH=${ISOL_ANALYSIS_API_PATH}
      - ISOL_ANALYSIS_JOBS_PORT=${ISOL_ANALYSIS_JOBS_PORT}
      - ISOL_ANALYSIS_JOBS_PATH=${ISOL_ANALYSIS_JOBS_PATH}
      - ISOL_AUDIT_HOST=${ISOL_AUDIT_DB_HOST}
      - ISOL_AUDIT_PORT=${ISOL_AUDIT_DB_PORT}
      - ISOL_AUDIT_USERNAME=${ISOL_AUDIT_DB_USERNAME}
      - ISOL_AUDIT_PASSWORD=${ISOL_AUDIT_DB_PASSWORD}
      - ISOL_AUDIT_DATABASE_NAME=${ISOL_AUDIT_DB_NAME}
      - ISOL_API_SERVICE_APPLICATION_TYPE=${ISOL_API_SERVICE_APPLICATION_TYPE}
      - ISOL_API_SERVICE_ALLOWED_ORIGINS=${ISOL_EXTERNAL_PROTOCOL}://${DISCOVER_UI_EXTERNAL_HOST}:${DISCOVER_UI_EXTERNAL_PORT},${ISOL_API_SERVICE_ADDITIONAL_ALLOWED_ORIGINS}
      - ISOL_API_SERVICE_BASE_URL=${ISOL_EXTERNAL_PROTOCOL}://${ISOL_API_SERVICE_EXTERNAL_HOST}:${ISOL_API_SERVICE_EXTERNAL_PORT}${ISOL_API_SERVICE_EXTERNAL_PATH}
      - ISOL_WATCHLIST_MIN_EVENT_AGE_SECONDS=${ISOL_API_SERVICE_WATCHLIST_MIN_EVENT_AGE_SECONDS}
      - ISOL_STATS_MIN_ANALYSIS_JOB_EVENT_AGE_SECONDS=${ISOL_API_SERVICE_STATS_MIN_ANALYSIS_JOB_EVENT_AGE_SECONDS}
      - ISOL_ENTITY_EXPIRY_POLE_LIFETIME_DAYS=${ISOL_ENTITY_EXPIRY_POLE_LIFETIME_DAYS}
      - ISOL_ENTITY_EXPIRY_CASE_LIFETIME_DAYS=${ISOL_ENTITY_EXPIRY_CASE_LIFETIME_DAYS}
      - ISOL_ENTITY_MAX_MAX_RESULTS=${ISOL_ENTITY_MAX_MAX_RESULTS}
      - ISOL_ENTITY_DEFAULT_MAX_RESULTS=${ISOL_ENTITY_DEFAULT_MAX_RESULTS}
      - ISOL_ENTITY_DEFAULT_MAX_SUGGEST_RESULTS=${ISOL_ENTITY_DEFAULT_MAX_SUGGEST_RESULTS}
      - ISOL_ENTITY_IDOL_SECURITY_MODE=${ISOL_ENTITY_IDOL_SECURITY_MODE}
      - ISOL_GLOBAL_TEAM_OWNER={$ISOL_GLOBAL_TEAM_OWNER}
      - ISOL_API_SERVICE_API_LOG_LEVEL={$ISOL_API_SERVICE_API_LOG_LEVEL}
      - ISOL_API_SERVICE_AUDIT_LOG_LEVEL={$ISOL_API_SERVICE_AUDIT_LOG_LEVEL}
volumes:
  entity-data:
